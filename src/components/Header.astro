---
const primaryLinks = [
  { href: '/termine', label: 'Termine' },
  { href: '/reparaturen', label: 'Ablauf & Reparaturen' },
  { href: '/ort-und-anfahrt', label: 'Ort & Anfahrt' },
  { href: '/aktuelles', label: 'Aktuelles' },
  { href: '/ueber-uns', label: 'Über uns' }
];
---

<header class="sticky top-0 z-50 w-full">
  <div class="relative">
    <div class="absolute inset-0 backdrop-blur supports-[backdrop-filter]:bg-white/60 dark:supports-[backdrop-filter]:bg-slate-900/50"></div>
    <nav class="relative mx-auto container flex items-center gap-6 py-3">
      <a href="/" class="flex items-center gap-2 text-xl font-medium">
        <img src="/repair-cafe-logo.png" alt="Repair Café Leonberg" class="h-10 w-10 object-contain self-center" />
        <span class="font-logo text-[1.5rem] md:text-[1.7rem] tracking-[0.08em]">Repair Café Leonberg</span>
      </a>
      <div class="hidden md:flex flex-1 items-center justify-center gap-6">
        {primaryLinks.map((item) => (
          <a
            href={item.href}
            class="text-sm font-medium text-slate-700 transition hover:text-slate-900 dark:text-slate-200 dark:hover:text-white"
          >
            {item.label}
          </a>
        ))}
      </div>
      <div class="hidden md:flex items-center gap-3">
        <a
          href="/members"
          class="inline-flex items-center rounded-full border border-slate-200/80 bg-white/70 px-4 py-2 text-sm font-semibold text-slate-700 shadow-sm transition hover:-translate-y-0.5 hover:border-brand-300 hover:text-brand-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-brand-500 dark:border-slate-700 dark:bg-slate-900/60 dark:text-slate-200"
        >
          Mitglieder-Login
        </a>
        <a
          href="/kontakt"
          class="inline-flex items-center rounded-full bg-[#DD714D] px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:-translate-y-0.5 hover:bg-[#c35a39] focus:outline-none focus-visible:ring-2 focus-visible:ring-brand-500"
        >
          Kontakt
        </a>
      </div>

      <div class="md:hidden ml-auto">
        <button
          id="mobile-menu-toggle"
          type="button"
          class="group relative flex h-10 w-10 items-center justify-center rounded-xl border border-slate-200 bg-white/80 text-slate-700 shadow-sm transition hover:-translate-y-0.5 hover:border-brand-500 hover:text-brand-600 focus:outline-none focus-visible:ring-2 focus-visible:ring-brand-500 dark:border-slate-700 dark:bg-slate-900/70 dark:text-slate-200"
          aria-label="Menü öffnen"
          aria-expanded="false"
          aria-controls="mobile-menu"
          data-state="closed"
        >
          <span class="sr-only">Menü öffnen</span>
          <span aria-hidden class="absolute h-[2px] w-6 -translate-y-2 rounded-full bg-current transition-all duration-300 group-data-[state=open]:translate-y-0 group-data-[state=open]:rotate-45"></span>
          <span aria-hidden class="absolute h-[2px] w-6 rounded-full bg-current transition-all duration-300 group-data-[state=open]:opacity-0"></span>
          <span aria-hidden class="absolute h-[2px] w-6 translate-y-2 rounded-full bg-current transition-all duration-300 group-data-[state=open]:translate-y-0 group-data-[state=open]:-rotate-45"></span>
        </button>
      </div>
    </nav>
  </div>
  <div
    id="mobile-menu"
    data-state="closed"
    class="group fixed inset-0 z-50 hidden opacity-0 pointer-events-none transition duration-300 ease-out md:hidden data-[state=open]:pointer-events-auto data-[state=open]:opacity-100"
  >
    <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm opacity-0 transition duration-300 ease-out group-data-[state=open]:opacity-100" data-menu-backdrop></div>
    <div class="relative z-10 mt-16 flex h-[calc(100%-4rem)] translate-y-4 flex-col px-5 pb-6 transition-transform duration-300 ease-out group-data-[state=open]:translate-y-0">
      <div class="mx-auto w-full max-w-xl rounded-2xl bg-white/95 p-6 shadow-2xl ring-1 ring-slate-200 dark:bg-slate-900/95 dark:ring-slate-700/60">
        <div class="flex items-center justify-between">
          <a href="/" class="flex items-center gap-2 text-lg font-medium text-slate-900 dark:text-white">
            <img src="/repair-cafe-logo.png" alt="Repair Café Leonberg" class="h-8 w-8 object-contain self-center" />
            <span class="font-logo text-[1.35rem] tracking-[0.08em] font-normal">Repair Café Leonberg</span>
          </a>
          <button id="mobile-menu-close" type="button" class="rounded-xl p-2 text-slate-500 transition hover:bg-slate-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-brand-500 dark:text-slate-300 dark:hover:bg-slate-800" aria-label="Menü schließen">
            <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 6l12 12M6 18 18 6"/></svg>
          </button>
        </div>

        <div class="mt-6 space-y-2">
          {primaryLinks.map((item) => (
            <a
              href={item.href}
              class="flex items-center justify-between rounded-xl px-3 py-3 text-base font-semibold text-slate-900 transition hover:bg-brand-50 hover:text-brand-700 dark:text-white dark:hover:bg-slate-800"
            >
              <span>{item.label}</span>
              <svg class="h-4 w-4 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 6l6 6-6 6" /></svg>
            </a>
          ))}
          <div class="pt-4 space-y-2 border-t border-slate-200/60 dark:border-slate-700/60">
            <a
              href="/kontakt"
              class="flex items-center justify-between rounded-xl border border-brand-200 bg-brand-50 px-3 py-3 text-base font-semibold text-brand-700 transition hover:-translate-y-0.5 hover:bg-brand-100"
            >
              <span>Kontakt</span>
              <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 6l6 6-6 6" /></svg>
            </a>
            <a
              href="/members"
              class="flex items-center justify-between rounded-xl border border-brand-200 bg-brand-50 px-3 py-3 text-base font-semibold text-brand-700 transition hover:-translate-y-0.5 hover:bg-brand-100"
            >
              <span>Mitglieder-Login</span>
              <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 6l6 6-6 6" /></svg>
            </a>
          </div>
          <div class="pt-4 flex justify-center">
            <a href="https://www.instagram.com/repairleonberg/#" target="_blank" rel="noopener" class="inline-flex items-center gap-2 rounded-full bg-white px-4 py-2 text-sm font-semibold text-brand-600 shadow-sm ring-1 ring-brand-100 transition hover:-translate-y-0.5 hover:bg-brand-50">
              <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"><rect x="3" y="3" width="18" height="18" rx="4" /><circle cx="12" cy="12" r="4" /><path d="M16.5 7.5h.01" /></svg>
              Besuchen Sie uns auf Instagram
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script type="module">
    const initMobileMenu = () => {
      const mobileToggle = document.getElementById('mobile-menu-toggle');
      const mobileClose = document.getElementById('mobile-menu-close');
      const mobileMenu = document.getElementById('mobile-menu');
      if (!mobileToggle || !mobileMenu) return;

      let closeAnimationHandler;

      function setMobileMenu(open) {
        if (!mobileMenu || !mobileToggle) return;
        if (open) {
          mobileMenu.classList.remove('hidden');
          requestAnimationFrame(() => {
            mobileMenu.setAttribute('data-state', 'open');
          });
          if (closeAnimationHandler) {
            mobileMenu.removeEventListener('transitionend', closeAnimationHandler);
            closeAnimationHandler = undefined;
          }
        } else {
          mobileMenu.setAttribute('data-state', 'closed');
          closeAnimationHandler = (event) => {
            if (event.target !== mobileMenu) return;
            mobileMenu.classList.add('hidden');
            mobileMenu.removeEventListener('transitionend', closeAnimationHandler);
            closeAnimationHandler = undefined;
          };
          mobileMenu.addEventListener('transitionend', closeAnimationHandler);
        }
        mobileToggle.setAttribute('aria-expanded', String(open));
        mobileToggle.setAttribute('aria-label', open ? 'Menü schließen' : 'Menü öffnen');
        mobileToggle.setAttribute('data-state', open ? 'open' : 'closed');
        const srText = mobileToggle.querySelector('.sr-only');
        if (srText) {
          srText.textContent = open ? 'Menü schließen' : 'Menü öffnen';
        }
        document.body.classList.toggle('overflow-hidden', open);
      }

      function toggleMobileMenu() {
        const isOpen = mobileMenu?.classList.contains('hidden') === false;
        setMobileMenu(!isOpen);
      }

      mobileToggle.addEventListener('click', toggleMobileMenu);
      mobileClose?.addEventListener('click', () => setMobileMenu(false));
      mobileMenu.addEventListener('click', (event) => {
        if (event.target === mobileMenu || event.target?.hasAttribute('data-menu-backdrop')) {
          setMobileMenu(false);
        }
      });
      window.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          setMobileMenu(false);
        }
      });
      mobileMenu.querySelectorAll('a').forEach((link) => {
        link.addEventListener('click', () => setMobileMenu(false));
      });
    };

    const schedule = (fn) =>
      'requestIdleCallback' in window ? window.requestIdleCallback(fn) : window.setTimeout(fn, 0);

    if (document.readyState === 'interactive' || document.readyState === 'complete') {
      schedule(initMobileMenu);
    } else {
      document.addEventListener(
        'DOMContentLoaded',
        () => {
          schedule(initMobileMenu);
        },
        { once: true }
      );
    }
  </script>
</header>
